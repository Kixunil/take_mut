http://pastebin.com/eFW142tK
That was my work before I gave up.

What I was trying to do was define a macro to allow take's with multiple mut_ref's, if anyone wants to try. It is not fun.
